<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mapa Simple - Sin Mapbox</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Usar OpenStreetMap con Leaflet como alternativa -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body class="bg-gray-900 text-white p-8">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">üó∫Ô∏è Mapa de Alertas - Versi√≥n OpenStreetMap</h1>
        
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Alternativa con OpenStreetMap (Gratuito)</h2>
            
            <!-- Controles de filtro -->
            <div class="mb-4">
                <h3 class="text-lg font-semibold mb-2">Filtrar Alertas</h3>
                <div class="flex flex-wrap gap-4">
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="filter-traffic" checked>
                        <span class="text-sm">üöó Tr√°fico</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="filter-natural" checked>
                        <span class="text-sm">üåä Fen√≥menos Naturales</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="filter-security" checked>
                        <span class="text-sm">‚ö†Ô∏è Seguridad</span>
                    </label>
                </div>
            </div>
            
            <!-- Contenedor del mapa -->
            <div id="map" style="height: 500px; width: 100%; border-radius: 12px;"></div>
            
            <!-- Leyenda -->
            <div class="mt-6 bg-gray-700 rounded-lg p-4">
                <h4 class="font-semibold mb-3">Leyenda de Colores</h4>
                <div class="grid grid-cols-3 gap-4 text-sm">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-red-600 rounded-full"></div>
                        <span>Alta - Cr√≠tico</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-orange-500 rounded-full"></div>
                        <span>Media - Moderado</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-green-500 rounded-full"></div>
                        <span>Baja - Leve</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Estado del Sistema</h2>
            <div id="status" class="text-green-400">Inicializando...</div>
        </div>
    </div>

    <script>
        let map;
        let markers = [];
        
        // Datos de alertas de ejemplo
        const alertasData = [
            {
                id: 1,
                tipo: 'traffic',
                titulo: 'Congesti√≥n Vial',
                ubicacion: 'Centro Hist√≥rico',
                descripcion: 'Tr√°fico pesado en zona centro',
                severidad: 'media',
                lat: 4.598,
                lng: -74.075,
                tiempo: 'Hace 15 min'
            },
            {
                id: 2,
                tipo: 'natural',
                titulo: 'Alerta S√≠smica',
                ubicacion: 'Zona Metropolitana',
                descripcion: 'Sismo de 4.2 grados detectado',
                severidad: 'alta',
                lat: 4.65,
                lng: -74.06,
                tiempo: 'Hace 5 min'
            },
            {
                id: 3,
                tipo: 'security',
                titulo: 'Zona de Riesgo',
                ubicacion: 'Ciudad Bol√≠var',
                descripcion: 'Reportes de actividad sospechosa',
                severidad: 'alta',
                lat: 4.57,
                lng: -74.18,
                tiempo: 'Hace 30 min'
            },
            {
                id: 4,
                tipo: 'traffic',
                titulo: 'Accidente Vial',
                ubicacion: 'Autopista Norte',
                descripcion: 'Colisi√≥n m√∫ltiple',
                severidad: 'alta',
                lat: 4.75,
                lng: -74.04,
                tiempo: 'Hace 10 min'
            },
            {
                id: 5,
                tipo: 'natural',
                titulo: 'Lluvia Intensa',
                ubicacion: 'Zona Sur',
                descripcion: 'Precipitaciones fuertes',
                severidad: 'media',
                lat: 4.55,
                lng: -74.12,
                tiempo: 'Hace 25 min'
            }
        ];

        function getMarkerColor(severidad) {
            switch(severidad) {
                case 'alta': return 'red';
                case 'media': return 'orange';
                case 'baja': return 'green';
                default: return 'blue';
            }
        }

        function getMarkerIcon(tipo) {
            switch(tipo) {
                case 'traffic': return 'üöó';
                case 'natural': return 'üåä';
                case 'security': return '‚ö†Ô∏è';
                default: return 'üìç';
            }
        }

        function initMap() {
            try {
                // Crear el mapa centrado en Bogot√°
                map = L.map('map').setView([4.65, -74.06], 11);

                // A√±adir capa de OpenStreetMap
                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);

                // A√±adir marcadores de alertas
                alertasData.forEach(alerta => {
                    // Crear icono personalizado
                    const iconHtml = `
                        <div style="
                            background-color: ${getMarkerColor(alerta.severidad)};
                            border: 2px solid white;
                            border-radius: 50%;
                            width: 30px;
                            height: 30px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 14px;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        ">
                            ${getMarkerIcon(alerta.tipo)}
                        </div>
                    `;

                    const customIcon = L.divIcon({
                        html: iconHtml,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15],
                        popupAnchor: [0, -15],
                        className: 'custom-marker'
                    });

                    // Crear marcador
                    const marker = L.marker([alerta.lat, alerta.lng], {
                        icon: customIcon
                    }).addTo(map);

                    // Popup con informaci√≥n de la alerta
                    const popupContent = `
                        <div style="color: black; font-family: system-ui;">
                            <h3 style="margin: 0 0 8px 0; font-weight: bold;">${alerta.titulo}</h3>
                            <p style="margin: 0 0 4px 0; font-size: 14px; color: #666;">${alerta.ubicacion}</p>
                            <p style="margin: 0 0 8px 0; font-size: 14px;">${alerta.descripcion}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="
                                    background-color: ${getMarkerColor(alerta.severidad)};
                                    color: white;
                                    padding: 2px 6px;
                                    border-radius: 4px;
                                    font-size: 12px;
                                    font-weight: bold;
                                ">${alerta.severidad.toUpperCase()}</span>
                                <span style="font-size: 12px; color: #666;">${alerta.tiempo}</span>
                            </div>
                        </div>
                    `;

                    marker.bindPopup(popupContent);
                    markers.push({marker, alerta});
                });

                // Configurar filtros
                setupFilters();

                document.getElementById('status').innerHTML = '‚úÖ Mapa cargado correctamente con OpenStreetMap';
                document.getElementById('status').className = 'text-green-400';

            } catch (error) {
                console.error('Error inicializando mapa:', error);
                document.getElementById('status').innerHTML = '‚ùå Error: ' + error.message;
                document.getElementById('status').className = 'text-red-400';
            }
        }

        function setupFilters() {
            const filterTraffic = document.getElementById('filter-traffic');
            const filterNatural = document.getElementById('filter-natural');
            const filterSecurity = document.getElementById('filter-security');

            function updateMarkers() {
                markers.forEach(({marker, alerta}) => {
                    let show = false;
                    
                    if (filterTraffic.checked && alerta.tipo === 'traffic') show = true;
                    if (filterNatural.checked && alerta.tipo === 'natural') show = true;
                    if (filterSecurity.checked && alerta.tipo === 'security') show = true;

                    if (show) {
                        map.addLayer(marker);
                    } else {
                        map.removeLayer(marker);
                    }
                });
            }

            filterTraffic.addEventListener('change', updateMarkers);
            filterNatural.addEventListener('change', updateMarkers);
            filterSecurity.addEventListener('change', updateMarkers);
        }

        // Inicializar mapa cuando cargue la p√°gina
        document.addEventListener('DOMContentLoaded', initMap);
    </script>

</body>
</html>
